import{d as P,r as i,a as x,o as R,c as d,b as s,t as C,g as r,w as y,e as a,u as j,h as I,n as S,i as u}from"./index-a_sggHWe.js";import{c as v,R as b,E as D,_ as E,C as J,B as M,a as H,W as L}from"./BottomSpinnerView-FbERe0wp.js";const U={key:0,class:"topic",id:"topic"},A={class:"topic-title"},O=["onClick"],z={key:0,class:"topic-author"},F={class:"topic-time"},W=["innerHTML"],X={key:0,class:"emoji"},Y=s("div",{style:{flex:"1"}},null,-1),q={key:1,class:"divider"},Z=P({__name:"TopicView",setup(G){const o=i({}),_=i(),f=i(new Date().getDate());let p=10;const w=i(1),c=i("default"),m=x([]),h=i("哼！Bangumi老娘我是有底线的人"),V={loadTopicDetail:async e=>{o.value=e,e.anchorCommentId.length>0&&(p=1e4,await g(null)),await S(),v.optContentJs(_.value),v.scrollToTargetComment(e.anchorCommentId)}},g=async e=>{const t=window.android.onCommentSort(c.value),n=window.android.onLoadComments(w.value,p,t),l=JSON.parse(n);c.value=t,l.length==0?e==null||e.complete():(m.push(...l),w.value++,await S(),l.length<p?e==null||e.complete():e==null||e.loaded())},k=e=>{var t;return{emojiParam:e.emojiParam,id:(t=e.emojiParam)==null?void 0:t.likeCommentId}},T=e=>{let t=k(o.value);window.android&&window.android.onClickCommentAction(JSON.stringify(t),e.clientX,e.clientY)},B=(e,t)=>{e==o.value.emojiParam.likeCommentId&&(o.value.emojis=t)},N=()=>{var t,n;const e=((t=o.value)==null?void 0:t.userId)||"";window.android&&e&&window.android&&window.android.onClickUser(e,(n=o.value)==null?void 0:n.id)};return R(()=>{window.robotSay=e=>{h.value=e},v.initComment(B,()=>m,e=>{c.value=e,w.value=1,m.length=0,f.value++}),window.topic=V,window.mounted=!0}),(e,t)=>{var n;return o.value.id?(u(),d("div",U,[s("div",A,C(o.value.title),1),s("div",{class:"topic-info",onClick:y(N,["stop"])},[o.value.userName?(u(),d("div",z,C(o.value.userName),1)):r("",!0),s("div",F,C(o.value.time),1)],8,O),a(b,{related:o.value.related},null,8,["related"]),s("div",{class:"topic-content",ref_key:"topicContentRef",ref:_,innerHTML:j(v).optText(o.value.content)},null,8,W),(n=o.value.emojiParam)!=null&&n.enable?(u(),d("div",X,[a(D,{class:"topic-emoji",emojis:o.value.emojis,comment:k(o.value)},null,8,["emojis","comment"]),Y,s("img",{class:"action",smileid:"",src:E,alt:"action",onClick:t[0]||(t[0]=y(l=>T(l),["stop"]))})])):r("",!0),o.value.content?(u(),d("div",q)):r("",!0),a(J,{target:"#topic",comments:m,sort:c.value,"master-id":o.value.userId,"anchor-id":o.value.anchorCommentId},null,8,["comments","sort","master-id","anchor-id"]),a(j(L),{class:"loading",target:"#topic",identifier:f.value,distance:300,onInfinite:g},{spinner:I(()=>[a(M)]),complete:I(()=>[a(H,{message:h.value},null,8,["message"])]),_:1},8,["identifier"])])):r("",!0)}}});export{Z as default};
