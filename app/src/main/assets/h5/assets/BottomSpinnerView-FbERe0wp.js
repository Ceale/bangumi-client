import{d as T,j as et,k as b,o as U,i as h,c as f,b as n,u as I,_ as j,t as C,F as M,f as N,g as S,w as k,e as E,r as H,p as q,l as B,m as K,q as G,s as ot,v as st,x as nt,y as it,z as O,n as Q}from"./index-a_sggHWe.js";const rt={class:"image-container"},ct=["src"],lt=T({__name:"ImageView",props:{src:{type:String},width:{type:String,default:"100%"},height:{type:String,default:"100%"}},setup(t){et(r=>({"4123973e":I(s),"16ed4428":I(i)}));const e=t,{src:o,width:s,height:i}=b(e),d=async r=>{const l=r.currentTarget;l.src="/ic_holder.jpg"};return U(()=>{console.log("Component mounted")}),(r,l)=>(h(),f("div",rt,[n("img",{class:"image",src:I(o),alt:"Image",onError:l[0]||(l[0]=u=>d(u))},null,40,ct)]))}}),P=j(lt,[["__scopeId","data-v-b3953fd3"]]),at={key:0,class:"relative"},dt={class:"relative-subject"},ut={class:"tip"},pt=["onClick"],_t={class:"title"},mt=T({__name:"RelativeItemView",props:{related:{type:Object,required:!1}},setup(t){const e=t,{related:o}=b(e),s=i=>{window.android&&window.android.onClickRelated(JSON.stringify(i))};return(i,d)=>I(o)&&I(o).items.length?(h(),f("div",at,[n("div",dt,[n("div",ut,C(I(o).title),1),(h(!0),f(M,null,N(I(o).items,r=>(h(),f("div",{class:"relative",onClick:k(l=>s(r),["stop"])},[E(P,{class:"cover",height:"44px",width:"44px",src:r.image},null,8,["src"]),n("div",_t,"# "+C(r.title),1)],8,pt))),256))])])):S("",!0)}}),$e=j(mt,[["__scopeId","data-v-1217f2f5"]]),ht=t=>(q("data-v-3540c0b3"),t=t(),B(),t),ft={class:"robot"},gt=ht(()=>n("div",{style:{flex:"1"}},null,-1)),vt={class:"message"},wt=T({__name:"BottomRobotView",props:{message:{type:String,required:!0}},setup(t){const e=t,{message:o}=b(e),s=H(),i=["robot-1","robot-2","robot-3","robot-4","robot-5","robot-6"];return U(()=>{var r;const d=Math.floor(Math.random()*i.length);return(r=s.value)==null?void 0:r.classList.add(i[d])}),(d,r)=>(h(),f("div",ft,[gt,n("div",{class:"robot-pic",ref_key:"robot",ref:s},null,512),n("div",vt,C(I(o)),1)]))}}),Te=j(wt,[["__scopeId","data-v-3540c0b3"]]),W="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1702628742133'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='7098'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='24'%20height='24'%3e%3cpath%20d='M863.701333%20202.965333a256%20256%200%200%201%2010.069334%20351.402667l-346.709334%20347.221333a21.333333%2021.333333%200%200%201-30.208%200l-346.624-347.221333a256%20256%200%200%201%20361.813334-361.130667%20255.914667%20255.914667%200%200%201%20351.658666%209.728zM220.672%20263.338667a170.666667%20170.666667%200%200%200-8.192%20232.576L512%20795.904l299.52-299.946667a170.666667%20170.666667%200%200%200-240.896-240.64L421.504%20404.48a42.666667%2042.666667%200%200%201-60.373333-60.373333l90.368-90.410667-3.498667-2.944a170.666667%20170.666667%200%200%200-227.328%2012.586667z'%20fill='%23000000'%20p-id='7099'%3e%3c/path%3e%3c/svg%3e";function yt(t){if(!t)return;const e=t.querySelectorAll("img"),o=[];for(let s=0;s<e.length;s++){const i=e[s],d=i.src;d!=null&&d.length>0&&d.indexOf("/img/smiles")==-1&&(o.push(d),i.onclick=()=>{window.android&&window.android.onPreviewImage(d,o)})}t.querySelectorAll("span.text_mask").forEach(s=>{const i=s;i.onclick=d=>{d.preventDefault(),Z(d.currentTarget)}})}const kt=t=>{if(Z(t))return!0;const e=t.tagName.toLowerCase();if(e=="a")return!0;if(e=="img"&&window.android){const o=t;return o.getAttribute("smileid")==null&&window.android.onPreviewImage(o.src,[o.src]),!0}return!1},Z=t=>{const e=D(t,".text_mask");return e?(e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show"),!0):!1},D=(t,e,o=3,s=0)=>!t||s>o?null:t.matches(e)?t:D(t.parentElement,e,o,s+1),Ct=(t,e,o)=>{const s=t.currentTarget;if(s&&e){const i=s.getBoundingClientRect();e.scrollTo({top:e.scrollTop+i.top-(o?40:10),behavior:"smooth"});const d=D(s,".comment-item",5);if(d!=null){const r=()=>{d.classList.remove("blinking"),d.removeEventListener("animationend",r)};d.classList.add("blinking"),d.addEventListener("animationend",r)}}},It=(t,e)=>{let o=e.replace(/<div class="quote">([^^]*?)<\/div>/,"").replace(/<span class="text_mask" style="([^^]*?)">([^^]*?)<\/span>/,"").replace(/<\/?[^>]+>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\B@([^\W_]\w*)\b/g,"＠$1");return o.length>100&&(o=o.slice(0,100)+"..."),"[quote][b]"+t+"[/b] 说: "+o+"[/quote]"},xt=t=>(t||"").trim().replace(/&nbsp;/g," ").trim();async function St(t){return new Promise(e=>setTimeout(e,t))}const $t=(t,e,o)=>{const s=l=>{for(const u in l){const g=l[u];let v=!1;if(e().forEach(p=>{p.id==u&&(v=!0)}),!v){const p=g.pst_id,w=g.pst_uid,$=F(g,p,w,!1);e().unshift($)}}},i=l=>{for(const u in l){const g=l[u];let v=null;if(e().forEach(p=>{p.id==u&&(v=p)}),v!=null){const p=v,w=p.id,$=p.userId,y=p.topicSubReply.map(m=>m.id),_=g.map(m=>F(m,w,$,!0)).filter(m=>!y.includes(m.id));p.topicSubReply.push(..._)}}},d=l=>{var v,p;const u=(v=l.posts)==null?void 0:v.main;u!=null&&s(u);const g=(p=l.posts)==null?void 0:p.sub;g!=null&&i(g)},r=l=>{console.log("刷新贴贴："+JSON.stringify(l,null,2));for(const u in l){const g=l[u];t&&t(u,g),e().forEach(v=>{v.id==u&&(v.emojis=g||[]),v.topicSubReply.forEach(p=>{p.id==u&&(p.emojis=g||[])})})}};window.comment={addComment:d,refreshEmoji:r,changeSort:o}},F=(t,e,o,s=!1)=>{const i={},d=s?1:0,r=s?t.pst_id:0,l=t.pst_uid,u=t.avatar||"";return i.id=t.pst_id,i.time=t.dateline,i.userAvatar=u.startsWith("//")?"https:"+u:u,i.userName=t.nickname,i.userId=t.username,i.replyContent=t.pst_content,i.replyJs=`subReply('${t.model}', ${t.pst_mid}, ${e}, ${r}, ${l}, ${o}, ${d})`,i.topicSubReply=[],i.emojiParam={enable:!1},i.emojis=[],i},Tt=t=>{if(t.length===0)return;const e=document.querySelector("#post_"+t);e!=null&&e.scrollIntoView()},V={optContentJs:yt,optText:xt,optReplyItemClick:kt,optReplyContent:It,scrollIntoView:Ct,delay:St,initComment:$t,scrollToTargetComment:Tt},bt={class:"emoji-container"},Rt=["onClick"],Et=["src"],jt={class:"user-count"},Lt=T({__name:"EmojiView",props:{emojis:{type:Array,required:!0},comment:{type:Object,required:!0}},setup(t){const e=t,{emojis:o,comment:s}=b(e),i=r=>{try{const l=parseInt(r);return l===0?"https://bgm.tv/img/smiles/tv/44.gif":`https://bgm.tv/img/smiles/tv/${l-39}.gif`}catch{return""}},d=r=>{const l=s==null?void 0:s.value;window.android.onToggleSmile(l.id,JSON.stringify(r))};return(r,l)=>(h(),f("div",bt,[(h(!0),f(M,null,N(I(o),u=>(h(),f("div",{class:K(["emoji",{selected:u.selected}]),key:u.value,onClick:k(g=>d(u),["stop"])},[n("img",{class:"smile",src:i(u.value),alt:"smile"},null,8,Et),n("span",jt,C(u.users.length),1)],10,Rt))),128))]))}}),Y=j(Lt,[["__scopeId","data-v-deb04d93"]]),J=t=>(q("data-v-223cb2ee"),t=t(),B(),t),Vt={class:"comment"},Mt={class:"comment-title"},Nt=J(()=>n("div",{class:"title"},"用户讨论",-1)),qt=["onClick"],Bt=J(()=>n("div",{style:{flex:"1"}},null,-1)),Jt=["id"],At={class:"comment-content"},Ot=["onClick"],Ht=["onClick"],Pt={key:0,class:"master"},Ut={class:"time"},Dt={class:"floor"},zt=J(()=>n("div",{style:{flex:"1"}},null,-1)),Gt=["onClick"],Wt={class:"topic-html-wrap"},Ft=["innerHTML","onClick","onTouchstart"],Yt={key:0,class:"anchor"},Xt=["id"],Kt=["onClick"],Qt={class:"info"},Zt=["onClick"],te={key:0,class:"master"},ee={class:"time"},oe={class:"floor"},se=J(()=>n("div",{style:{flex:"1"}},null,-1)),ne=["onClick"],ie={class:"topic-html-wrap"},re=["innerHTML","onTouchstart"],ce={key:0,class:"anchor"},le=T({__name:"CommentView",props:{target:{type:String,required:!0},comments:{type:Array,default:[],required:!0},sort:{type:String,required:!0},masterId:{type:String,required:!1,default:""},anchorId:{type:String,required:!1,default:""}},setup(t){const e=t,{target:o,comments:s,sort:i}=b(e),d=_=>{switch(_){case"desc":return"最新";case"hot":return"最热";case"asc":return"时间";default:return"默认"}},r=_=>{window.android&&_.userId&&window.android&&window.android.onClickUser(_.userId,_.id)},l=(_,m,c)=>{const R=_.target;if(V.optReplyItemClick(R))return;V.scrollIntoView(_,document.querySelector(o==null?void 0:o.value),c==null);const a=(c==null?void 0:c.replyJs)||"",L=m.replyJs||"",x=a.length>0,z=x?a:L,A=c||m;if(window.android){if(z.length>0){x&&(A.replyQuote=V.optReplyContent(A.userName,A.replyContent)),window.android.onReplyUser(a.length>0?a:z,JSON.stringify(c||m));return}window.android.onNeedLogin()}},u=()=>{window.android&&window.android.onClickCommentSort()},g=(_,m)=>{window.android&&window.android.onClickCommentAction(JSON.stringify(m),_.clientX,_.clientY)},v=_=>{V.scrollIntoView(_,document.querySelector(o==null?void 0:o.value),!0),window.android&&window.android.onReplyNew()};let p=0;const w=(_,m)=>{clearTimeout(p),p=setTimeout(()=>{const c=_.touches[0].clientX,R=_.touches[0].clientY;window.android&&window.android.onLongClickText(m,c,R)},500)},$=()=>{clearTimeout(p)},y=()=>{clearTimeout(p)};return(_,m)=>(h(),f("div",Vt,[n("div",Mt,[Nt,n("div",{class:"sort",onClick:k(u,["stop"])},"排序："+C(d(I(i))),9,qt),Bt,n("div",{class:"write",onClick:m[0]||(m[0]=k(c=>v(c),["stop"]))},"写留言")]),(h(!0),f(M,null,N(I(s),c=>{var R;return h(),f("div",{class:"comment-item",key:c.id,id:"post_"+c.id},[E(P,{class:"avatar",width:"36px",height:"36px",src:c.userAvatar,onClick:k(a=>r(c),["stop"])},null,8,["src","onClick"]),n("div",At,[n("div",{class:"info",onClick:k(a=>l(a,c,null),["stop"])},[n("div",{class:"user-name",onClick:k(a=>r(c),["stop"])},[n("span",null,C(c.userName),1),t.masterId===c.userId?(h(),f("span",Pt,"楼主")):S("",!0)],8,Ht),n("div",Ut,[G(C(c.time),1),n("span",Dt,C(c.floor),1)]),zt,(R=c.emojiParam)!=null&&R.enable?(h(),f("img",{key:0,class:"action",smileid:"",src:W,alt:"action",onClick:k(a=>g(a,c),["stop"])},null,8,Gt)):S("",!0)],8,Ot),n("div",Wt,[n("div",{class:"topic-html",innerHTML:c.replyContent,onClick:k(a=>l(a,c,null),["stop"]),onTouchstart:a=>w(a,c.replyContent),onTouchmove:$,onTouchend:y},null,40,Ft),c.id===t.anchorId?(h(),f("div",Yt)):S("",!0)]),E(Y,{emojis:c.emojis,comment:c,style:{"margin-top":"16px"}},null,8,["emojis","comment"]),(h(!0),f(M,null,N(c.topicSubReply||[],a=>{var L;return h(),f("div",{class:K(["comment-item sub",{anchor:a.id===t.anchorId}]),key:a.id,id:"post_"+a.id},[E(P,{class:"avatar",height:"24px",width:"24px",src:a.userAvatar,onClick:k(x=>r(a),["stop"])},null,8,["src","onClick"]),n("div",{class:"comment-content",onClick:k(x=>l(x,c,a),["stop"])},[n("div",Qt,[n("div",{class:"user-name sub",onClick:k(x=>r(a),["stop"])},[n("span",null,C(a.userName),1),t.masterId===a.userId?(h(),f("span",te,"楼主")):S("",!0)],8,Zt),n("div",ee,[G(C(a.time),1),n("span",oe,C(a.floor),1)]),se,(L=a.emojiParam)!=null&&L.enable?(h(),f("img",{key:0,class:"action",smileid:"",src:W,alt:"action",onClick:k(x=>g(x,a),["stop"])},null,8,ne)):S("",!0)]),n("div",ie,[n("div",{class:"topic-html",innerHTML:a.replyContent,onTouchstart:x=>w(x,a.replyContent),onTouchmove:$,onTouchend:y},null,40,re),a.id===t.anchorId?(h(),f("div",ce)):S("",!0)]),E(Y,{emojis:a.emojis,comment:a,style:{"margin-top":"16px"}},null,8,["emojis","comment"])],8,Kt)],10,Xt)}),128))])],8,Jt)}),128))]))}}),be=j(le,[["__scopeId","data-v-223cb2ee"]]);function ae(t,e){const o=t.getBoundingClientRect();if(!e)return o.top>=0&&o.bottom<=window.innerHeight;const s=e.getBoundingClientRect();return o.top>=s.top&&o.bottom<=s.bottom}async function de(t){return await Q(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function X(t){let e=`0px 0px ${t.distance}px 0px`;t.top&&(e=`${t.distance}px 0px 0px 0px`);const o=new IntersectionObserver(s=>{s[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:e});return o.observe(t.infiniteLoading.value),o}const tt=(t,e)=>{const o=t.__vccOpts||t;for(const[s,i]of e)o[s]=i;return o},ue={},pe=t=>(q("data-v-d3e37633"),t=t(),B(),t),_e={class:"container"},me=pe(()=>n("div",{class:"spinner"},null,-1)),he=[me];function fe(t,e){return h(),f("div",_e,he)}const ge=tt(ue,[["render",fe],["__scopeId","data-v-d3e37633"]]),ve={class:"state-error"},we=T({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:e}){const o=t;let s=null,i=0;const d=H(null),r=H(""),{top:l,firstload:u,distance:g}=o,{identifier:v,target:p}=b(o),w={infiniteLoading:d,top:l,firstload:u,distance:g,parentEl:null,emit(){i=(w.parentEl||document.documentElement).scrollHeight,$.loading(),e("infinite",$)}},$={loading(){r.value="loading"},async loaded(){r.value="loaded";const y=w.parentEl||document.documentElement;await Q(),l&&(y.scrollTop=y.scrollHeight-i),ae(d.value,w.parentEl)&&w.emit()},complete(){r.value="complete",s==null||s.disconnect()},error(){r.value="error"}};return ot(v,()=>{s==null||s.disconnect(),s=X(w)}),U(async()=>{w.parentEl=await de(p),s=X(w)}),st(()=>{s==null||s.disconnect()}),(y,_)=>(h(),f("div",{ref_key:"infiniteLoading",ref:d,style:{"min-height":"1px"}},[nt(n("div",null,[O(y.$slots,"spinner",{},()=>[E(ge)],!0)],512),[[it,r.value=="loading"]]),r.value=="complete"?O(y.$slots,"complete",{key:0},()=>{var m;return[n("span",null,C(((m=y.slots)==null?void 0:m.complete)||"No more results!"),1)]},!0):S("",!0),r.value=="error"?O(y.$slots,"error",{key:1,retry:w.emit},()=>{var m;return[n("span",ve,[n("span",null,C(((m=y.slots)==null?void 0:m.error)||"Oops something went wrong!"),1),n("button",{class:"retry",onClick:_[0]||(_[0]=(...c)=>w.emit&&w.emit(...c))},"retry")])]},!0):S("",!0)],512))}}),Re=tt(we,[["__scopeId","data-v-a7077831"]]),ye=t=>(q("data-v-18fb154c"),t=t(),B(),t),ke={key:0,class:"spinner-container"},Ce=ye(()=>n("div",{class:"spinner"},null,-1)),Ie=[Ce],xe=T({__name:"BottomSpinnerView",props:{show:{type:Boolean,default:!0}},setup(t){const e=t,{show:o}=b(e);return(s,i)=>I(o)?(h(),f("div",ke,Ie)):S("",!0)}}),Ee=j(xe,[["__scopeId","data-v-18fb154c"]]);export{Ee as B,be as C,Y as E,$e as R,Re as W,W as _,Te as a,V as c};
